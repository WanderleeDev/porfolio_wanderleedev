---
import { Icon } from "astro-iconify";
---

<button
  id="btnTheme"
  class="group relative overflow-hidden rounded-full bg-white/5 dark:bg-white/5 backdrop-blur-sm border border-gray-300/30 dark:border-white/10 p-2 transition-all duration-300 hover:bg-gray-200/50 dark:hover:bg-white/10 hover:border-gray-400/50 dark:hover:border-white/20 hover:scale-110 hover:shadow-[0_8px_24px_rgba(99,102,241,0.2)]"
>
  <span class="sr-only">Toggle Theme</span>
  <Icon class="dark:hidden size-5" name="heroicons-outline:sun" />
  <Icon class="hidden dark:block size-5" name="heroicons-outline:moon" />
</button>

<script>
  function getThemeAttr(attr: string) {
    return document.documentElement.attributes
      .getNamedItem(attr)
      ?.value?.trim();
  }

  function applyTheme(theme: string): void {
    const newTheme = theme === "light" ? "dark" : "light";
    document.dispatchEvent(new CustomEvent("set-theme", { detail: newTheme }));
  }

  function toggleTheme(): void {
    const currentTheme = localStorage.getItem("theme")?.trim();
    const preferencesTheme = getThemeAttr("data-theme-preference");
    const attrDocumentTheme = getThemeAttr("data-theme");
    const themes: Record<string, string> = {
      light: "light",
      dark: "dark",
    };

    if (currentTheme && themes[currentTheme]) {
      return applyTheme(currentTheme);
    }

    const backupTheme = preferencesTheme || attrDocumentTheme || themes.dark;

    return applyTheme(backupTheme);
  }

  function setupDarkMode() {
    const btnTheme = document.querySelector("#btnTheme");

    if (!btnTheme) return;

    btnTheme?.addEventListener("click", toggleTheme);
  }

  document.addEventListener("astro:page-load", setupDarkMode);
</script>
